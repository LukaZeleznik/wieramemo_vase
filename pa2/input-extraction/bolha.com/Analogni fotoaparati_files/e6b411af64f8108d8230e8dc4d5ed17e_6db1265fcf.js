(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{79:function(e,t,i){"use strict";i.r(t);var n=i(44),s=i.n(n),l=i(21),o=i.n(l),r=i(10),a=i.n(r),c=i(46),u=i(162),p=i.n(u),h=i(13),d=i(14),f=i(26),v=i.n(f),g=i(6);t.default=v.a.extend({el:".MultipleOptionHierarchySelector",childrenEl:{select:".MultipleOptionHierarchySelector-select"},init:function(e){var t=this;this.selectors={},this.store={},this.initialStateResolved=!1;var i=function(e){return e.hasAttribute("data-count")?"".concat(e.textContent," <span>").concat(e.dataset.count,"</span>"):e.textContent};this.selectrOptions={placeholder:Object(g.b)("ad_browse.multiple_option_hierarchy_selector.choose"),messages:{noResults:Object(g.b)("ad_browse.multiple_option_hierarchy_selector.no_results"),noOptions:"--"}},e.initialCountValues&&(this.selectrOptions.renderOption=i,this.selectrOptions.renderSelection=i),this.setOptions(Object.assign({},e,{levelKeyMap:Object.assign({},Object.keys(e.levelMap))})),Object.keys(this.options.levelMap).forEach((function(e){var i=t.$select[t.options.levelMap[e]];i.innerHTML="",t.store[e]=new h.Store,t.selectors[e]=new p.a(i,t.selectrOptions),t.selectors[e].disable(),t.$targetInput=a()("#".concat(t.options.elementTargetId)),t.setupEvents(e),t.modifySelectrBehaviour(e)})),this.fetchLevel(this.options.levelKeyMap[0])},modifySelectrBehaviour:function(e){var t=this.selectors[e];t.on("selectr.init",(function(){t.selected.removeAttribute("tabindex"),t.inputClear.addEventListener("click",(function(e){t.open()})),t.input.addEventListener("keydown",(function(e){9===e.keyCode&&t.close()})),t.options.length||t.container.classList.add("selectr-disabled")}))},setupEvents:function(e){var t=this,i=this.selectors[e];i.on("selectr.select",(function(i){var n=t.getSelectedValues(e);t.options.groupSelect&&t.options.groupSelect.target===i.value?t.groupSelect(e):(n.indexOf(i.value)<0&&n.push(i.value),t.saveCurrentState(),t.updateLevel(e),t.checkGroupSelectStatus(e))})),i.on("selectr.deselect",(function(i){var n=t.getSelectedValues(e);t.options.groupSelect&&t.options.groupSelect.target===i.value?t.groupDeselect(e):(n.splice(n.indexOf(i.value),1),t.removeChildFromTree(e,i.value),t.saveCurrentState(),t.updateLevel(e),t.checkGroupSelectStatus(e))})),a()(this.$select[this.options.levelMap[e]]).on("touchstart",(function(e){e.stopPropagation()})),this.$select[this.options.levelMap[e]].dispatchEvent=function(){}},destroyEvents:function(e){this.selectors[e].off("selectr.select"),this.selectors[e].off("selectr.deselect")},fetchLevel:function(e){var t=this,i=this.getParentKey(e),n=this.getChildKey(e),s=i&&this.getSelectedValues(i).length||0===this.options.levelMap[e],l=function(){t.selectors[e].options.length?t.selectors[e].enable():t.selectors[e].disable(),n?t.fetchLevel(n):(t.initialStateResolved=!0,t.saveCurrentState())};Promise.resolve(s?this.fetchData(e):{data:[]}).then((function(i){t.store[e].reset(),t.store[e].sync(i),t.populateSelect(e),t.selectors[e].destroy(),t.selectors[e].render(t.selectrOptions),l()})).catch((function(){l()}))},updateLevel:Object(c.debounce)(500,(function(e){var t=this.getChildKey(e);t&&(this.disableChildren(t),this.fetchLevel(t)),this.initialStateResolved&&"maxValuesCount"in this.options&&this.checkMaxValuesCount()})),fetchData:function(e){var t=this,i=o.a.parse(this.options.initialValues[e].url),n=this.generateUrlQuery(i,e);return Object(d.default)({url:o.a.format({pathname:i.pathname,query:n})}).then((function(i){return i.data.length&&(t.options.initialValues[e].type=i.data[0].type),i.included&&delete i.included,i}))},appendOption:function(e,t,i){this.getSelectedValues(t);var n=document.createElement("option");n.value=i.value,n.text=i.text,n.selected=i.selected,i.count&&(n.dataset.count=i.count),i.selected&&n.setAttribute("selected","selected"),e.appendChild(n)},populateSelect:function(e){var t=this,i=this.generateData(e),n=this.$select[this.options.levelMap[e]];n.innerHTML="",n.classList.remove("hidden"),i.forEach((function(i){if(i.children){var s=document.createElement("optgroup");s.label=i.text,i.children.forEach((function(i){return t.appendOption(s,e,i)})),n.appendChild(s)}else t.appendOption(n,e,i)}))},generateUrlQuery:function(e,t){var i=this.getFilter(t),n=s.a.parse(e.query);return i.name&&(n["filter[".concat(i.name,"]")]=this.getSelectedValues(i.field).join(",")),n},generateData:function(e){var t=this,i=this.store[e].findAll(this.getLevelType(e));if(i.length){var n=this.getParentKey(e),s=this.getFilter(e),l=this.getSelectedValues(e),o=this.options.initialCountValues,r=function(e){return!!l.length&&l.indexOf(e)>-1};return s.field&&s.field===n?this.getSelectedValues(n).map((function(i){var l=t.store[n].find(t.getLevelType(n),i),o=t.store[e].findAll(t.getLevelType(e)).filter((function(e){return e[s.name]&&e[s.name].id===l.id})).map((function(e){return{value:e.id,text:e.title,selected:r(e.id)}}));return o.length?{text:l.title,children:o}:null})).filter((function(e){return null!==e})).sort((function(e,t){return e.text.toLowerCase().localeCompare(t.text.toLowerCase())})):(o&&i.forEach((function(e){var t=o.find((function(t){return t.locationId===parseInt(e.id,10)}));t&&(e.initialCount=t.count)})),i.filter((function(e){return Boolean(e.title)})).map((function(e){return{value:e.id,text:e.title,count:e.initialCount,selected:r(e.id)}})))}return[]},remove:function(){var e=this;Object.keys(this.options.levelMap).forEach((function(t){e.store[t].reset(),e.destroyEvents(t),e.selectors[t].destroy()})),v.a.prototype.remove.apply(this,arguments)},disableChildren:function(e){var t=this.getChildKey(e);this.selectors[e].disable(),t&&this.disableChildren(t)},removeChildFromTree:function(e,t){var i=this,n=this.getChildKey(e);n&&(this.options.initialValues[n].selectedValues=this.getSelectedValues(n).filter((function(t){var s=i.getFilter(n),l=i.store[n].find(i.getLevelType(n),t)[s.name];return l&&i.getSelectedValues(e).indexOf(l.id)>-1})),this.removeChildFromTree(n,parent.id))},saveCurrentState:function(){var e=this,t=Object.keys(this.options.levelMap).reduce((function(t,i){var n=e.getSelectedValues(i),s=e.getFilter(i);return s.name&&n.forEach((function(n){var l=e.store[i].find(e.getLevelType(i),n);if(l){var o=l[s.name].id,r=t.indexOf(o);r>-1&&(t[r]=null)}})),t.concat(n)}),[]).filter((function(e){return null!==e})).join(",");this.$targetInput.val(t)},checkGroupSelectStatus:function(e){if(this.options.groupSelect){var t=this.getSelectedValues(e),i=this.options.groupSelect.values.slice().reduce((function(e,i){return!(t.indexOf(i)<0)&&e}),!0);this.groupSelectSilentUpdate||(i?this.groupTargetSelect(e):this.groupTargetDeselect(e))}},groupSelect:function(e){if(this.groupSelectSilentUpdate)this.groupSelectSilentUpdate=!1;else{var t=this.getSelectedValues(e),i=this.options.groupSelect.values.slice();this.selectors[e].setValue(i.filter((function(e){return t.indexOf(e)<0})))}},groupDeselect:function(e){if(this.groupSelectSilentUpdate)this.groupSelectSilentUpdate=!1;else{var t=this.getSelectedValues(e),i=this.options.groupSelect.values.slice();this.selectors[e].setValue(i.filter((function(e){return t.indexOf(e)>-1})))}},groupTargetSelect:function(e){var t=this;this.selectors[e].getValue().indexOf(this.options.groupSelect.target)<0&&(this.groupSelectSilentUpdate=!0,setTimeout((function(){t.selectors[e].setValue(t.options.groupSelect.target)}),0))},groupTargetDeselect:function(e){this.selectors[e].getValue().indexOf(this.options.groupSelect.target)>-1&&(this.groupSelectSilentUpdate=!0,this.selectors[e].setValue(this.options.groupSelect.target))},checkMaxValuesCount:function(){var e=this.$targetInput.val().split(",");this.maxValuesCountAmountMemo=this.maxValuesCountAmountMemo||0,e.length>this.options.maxValuesCount.amount&&e.length>this.maxValuesCountAmountMemo&&(this.maxValuesCountAmountMemo=e.length,alert(this.options.maxValuesCount.message))},getLevelType:function(e){return this.options.initialValues[e].type},getFilter:function(e){return this.options.initialValues[e].filters[0]||{}},getSelectedValues:function(e){return this.options.initialValues[e].selectedValues},getChildKey:function(e){return this.options.levelKeyMap[this.options.levelMap[e]+1]},getParentKey:function(e){return this.options.levelKeyMap[this.options.levelMap[e]-1]}})}}]);