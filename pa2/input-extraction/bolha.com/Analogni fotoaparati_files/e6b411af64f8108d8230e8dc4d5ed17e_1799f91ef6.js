(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{822:function(t,e,o){"use strict";o.r(e),o.d(e,"default",(function(){return g}));var n=o(16),a=o(5),u=o(9),r=o(7),c=o(8),i=o(2),l=o(1),s=o(0),p=o(11),d=o(13),h=o(14),f=o(6);function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=Object(i.a)(t);if(e){var a=Object(i.a)(this).constructor;o=Reflect.construct(n,arguments,a)}else o=n.apply(this,arguments);return Object(c.a)(this,o)}}var g=function(t){Object(r.a)(c,t);var e=b(c);function c(t){var o;return Object(a.a)(this,c),(o=e.call(this,t)).cacheChildrenEl({input:o.props.input}),o.setState({autoCompleteValue:o.$input.value}),o.store=new d.Store,o.setup(),o}return Object(u.a)(c,[{key:"setup",value:Object(s.a)((function(){var t=this;return Object(s.b)(Promise.all([Promise.all([o.e(6),o.e(46),o.e(47)]).then(o.bind(null,457)),Promise.all([o.e(6),o.e(46),o.e(47)]).then(o.bind(null,46)),Promise.all([o.e(6),o.e(46),o.e(47)]).then(o.t.bind(null,730,7))]),(function(e){var o=Object(n.a)(e,3),a=o[0].default,u=o[1].debounce,r=o[2].findAll;t.autosuggest=a(t.$input,{htmlClassNamespace:"GeoLocationSelector-dropdown",decorateInputEvent:function(t){return u(300,t)},onOptionSelect:function(e,o,n){t.setState({preventSubmit:!0}),t.$input.blur(),n.autoLocate?t.autoLocate():t.setState({disabled:!1,autoCompleteValue:o,autoLocateError:!1,coordinates:{lat:n.latitude,lng:n.longitude}})},onFocus:Object(s.a)((function(e){return""===t.$input.value?t.props.autoLocate?[t.generateAutolocate()]:[]:e})),onQueryInput:Object(s.a)((function(e){return e.trim().length<3?t.prependAutoLocate([]):(t.setState({loading:!0}),Object(s.b)(Object(h.default)({url:t.props.url.replace("{{address}}",e),type:"get"}),(function(o){return t.store.reset(),t.store.sync(o),t.setState({loading:!1}),t.prependAutoLocate(t.store.findAll("locality-suggestion").map((function(t){return{content:r({searchWords:[e],textToHighlight:t.title}).map((function(e){var o=e.end,n=e.highlight,a=e.start,u=t.title.substr(a,o-a);return n?'\n\t\t\t\t\t\t\t\t\t\t<mark\n\t\t\t\t\t\t\t\t\t\t\tclass="GeoLocationSelector-dropdown-match"\n\t\t\t\t\t\t\t\t\t\t\t>'.concat(u,"</mark\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t"):u})).join(""),value:t.title,meta:t.coordinate}})))})))}))})}))}))},{key:"preventSubmit",value:function(t){if(13===t.keyCode){t.preventDefault();var e=this.store.findAll("locality-suggestion"),o=Object(n.a)(e,1)[0];o&&!this.state.preventSubmit&&(this.$input.blur(),this.setState({disabled:!1,autoCompleteValue:o.title,autoLocateError:!1,coordinates:{lat:o.coordinate.latitude,lng:o.coordinate.longitude}}))}this.setState({preventSubmit:!1})}},{key:"autoLocate",value:function(){var t=this;return this.setState({loading:!0}),this.props.parent.autoLocateSelector.fetch().then((function(e){return Object(h.default)({url:t.props.autoLocate.url.replace("{{lat}}",e.coords.latitude).replace("{{lng}}",e.coords.longitude)}).then((function(o){var n=o.data.attributes;t.setState({disabled:!1,loading:!1,autoCompleteValue:"".concat(n.street," ").concat(n.houseNumber,", ").concat(n.town),coordinates:{lat:e.coords.latitude,lng:e.coords.longitude}})}))})).catch((function(e){throw t.setState({loading:!1}),e}))}},{key:"prependAutoLocate",value:function(t){return this.props.autoLocate&&t.unshift(this.generateAutolocate()),t}},{key:"generateAutolocate",value:function(){return{content:'\n\t\t\t\t<button\n\t\t\t\t\ttype="button"\n\t\t\t\t\tclass="GeoLocationSelector-autoLocateButton"\n\t\t\t\t>\n\t\t\t\t\t<i\n\t\t\t\t\t\tclass="GeoLocationSelector-iconGeolocate icon icon--xs icon--geolocate"\n\t\t\t\t\t\taria-hidden="true"\n\t\t\t\t\t\trole="presentation"\n\t\t\t\t\t></i>\n\t\t\t\t\t'.concat(Object(f.b)("geolocation.web.filter.autolocate_fetch"),"\n\t\t\t\t</button>\n\t\t\t"),value:"",meta:{autoLocate:!0}}}},{key:"triggerSearchDropdown",value:function(t){this.props.isRangeBlocked()&&(t.preventDefault(),this.$input.blur(),this.props.parent.props.onConflict())}},{key:"inputCleanUp",value:function(){this.props.parent.disabled?this.setState({autoCompleteValue:""}):""===this.$input.value?this.clear():this.state.autoCompleteValue!==this.$input.value&&this.setState({autoCompleteValue:this.state.autoCompleteValue})}},{key:"clear",value:function(){this.setState({disabled:!0,autoLocateError:!1,autoCompleteValue:"",coordinates:{lat:"",lng:""}})}},{key:"render",value:function(t,e){"disabled"!==t&&"coordinates"!==t&&"autoLocateError"!==t&&"loading"!==t||this.props.update(Object(l.a)({},t,e)),"autoCompleteValue"===t&&(this.$input.value=e),"disabled"===t&&(this.$clearButton.classList.toggle("hidden",e),e&&(this.$input.value=""))}}]),c}(p.a);Object(l.a)(g,"childrenEl",{clearButton:".GeoLocationSelector-iconClose"}),Object(l.a)(g,"events",{"keydown .GeoLocationSelector-autoCompleteInput":"preventSubmit","focus .GeoLocationSelector-autoCompleteInput":"triggerSearchDropdown","blur .GeoLocationSelector-autoCompleteInput":"inputCleanUp","click .GeoLocationSelector-iconClose":"clear"})}}]);