(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{70:function(t,e,i){"use strict";i.d(e,"c",(function(){return c})),i.d(e,"g",(function(){return s})),i.d(e,"d",(function(){return o})),i.d(e,"f",(function(){return u})),i.d(e,"e",(function(){return l})),i.d(e,"b",(function(){return h})),i.d(e,"a",(function(){return d}));var n=window.navigator.userAgent,a=/ptst/i.test(n),r=/google page speed insights|chrome-lighthouse/i.test(n);function c(){return"is_mobile_app"in window&&!0===window.is_mobile_app}function s(){return"mobile_app_type"in window?window.mobile_app_type:""}function o(){try{return Boolean(webkit.messageHandlers.iOS)}catch(t){return!1}}function u(){return a}function l(){return r}function h(){return/iphone/i.test(n)}function d(){return/android/i.test(n)}},768:function(t,e){var i=/^(?:submit|button|image|reset|file)$/i,n=/^(?:input|select|textarea|keygen)/i,a=/(\[[^\[\]]*\])/g;function r(t,e,i){if(0===e.length)return t=i;var n=e.shift(),a=n.match(/^\[(.+?)\]$/);if("[]"===n)return t=t||[],Array.isArray(t)?t.push(r(null,e,i)):(t._values=t._values||[],t._values.push(r(null,e,i))),t;if(a){var c=a[1],s=+c;isNaN(s)?(t=t||{})[c]=r(t[c],e,i):(t=t||[])[s]=r(t[s],e,i)}else t[n]=r(t[n],e,i);return t}function c(t,e,i){if(e.match(a)){r(t,function(t){var e=[],i=new RegExp(a),n=/^([^\[\]]*)/.exec(t);for(n[1]&&e.push(n[1]);null!==(n=i.exec(t));)e.push(n[1]);return e}(e),i)}else{var n=t[e];n?(Array.isArray(n)||(t[e]=[n]),t[e].push(i)):t[e]=i}return t}function s(t,e,i){return i=i.replace(/(\r)?\n/g,"\r\n"),i=(i=encodeURIComponent(i)).replace(/%20/g,"+"),t+(t?"&":"")+encodeURIComponent(e)+"="+i}t.exports=function(t,e){"object"!=typeof e?e={hash:!!e}:void 0===e.hash&&(e.hash=!0);for(var a=e.hash?{}:"",r=e.serializer||(e.hash?c:s),o=t&&t.elements?t.elements:[],u=Object.create(null),l=0;l<o.length;++l){var h=o[l];if((e.disabled||!h.disabled)&&h.name&&(n.test(h.nodeName)&&!i.test(h.type))){var d=h.name,f=h.value;if("checkbox"!==h.type&&"radio"!==h.type||h.checked||(f=void 0),e.empty){if("checkbox"!==h.type||h.checked||(f=""),"radio"===h.type&&(u[h.name]||h.checked?h.checked&&(u[h.name]=!0):u[h.name]=!1),null==f&&"radio"==h.type)continue}else if(!f)continue;if("select-multiple"!==h.type)a=r(a,d,f);else{f=[];for(var p=h.options,v=!1,b=0;b<p.length;++b){var m=p[b],S=e.empty&&!m.value,g=m.value||S;m.selected&&g&&(v=!0,a=e.hash&&"[]"!==d.slice(d.length-2)?r(a,d+"[]",m.value):r(a,d,m.value))}!v&&e.empty&&(a=r(a,d,""))}}}if(e.empty)for(var d in u)u[d]||(a=r(a,d,""));return a}},881:function(t,e,i){"use strict";i.r(e);var n=i(28),a=i(5),r=i(9),c=i(18),s=i(7),o=i(8),u=i(2),l=i(1),h=i(16),d=i(0),f=i(21),p=i.n(f),v=i(44),b=i.n(v),m=i(11),S=i(27),g=i(13),O=i(768),y=i.n(O),j=i(14),C=i(4),_=i.n(C),k=i(30),N=i(25),x=i(20),A=i(6),w=i(70),E=i(33);function $(){var t=Object(n.a)(['\n\t\t\t<div class="notification notification--','">\n\t\t\t\t<p>',"</p>\n\t\t\t</div>\n\t\t"]);return $=function(){return t},t}function P(){var t=Object(n.a)(['\n\t\t\t<div class="notification notification--','">\n\t\t\t\t<p>',"</p>\n\t\t\t</div>\n\t\t"]);return P=function(){return t},t}function F(){var t=Object(n.a)(['\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="','"\n\t\t\t\t\t\tclass="SavedSearchCreate-baseAction SavedSearchCreate-baseAction--edit"\n\t\t\t\t\t\tdata-test-id="saved_search.create.go_to_edit"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="TextWithIcon"\n\t\t\t\t\t\t\t><i\n\t\t\t\t\t\t\t\tclass="icon icon--xs icon--saved-search-create"\n\t\t\t\t\t\t\t\taria-hidden="true"\n\t\t\t\t\t\t\t\trole="presentation"\n\t\t\t\t\t\t\t></i\n\t\t\t\t\t\t\t>',"</span\n\t\t\t\t\t\t>\n\t\t\t\t\t</a>\n\t\t\t\t"]);return F=function(){return t},t}function R(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Object(u.a)(t);if(e){var a=Object(u.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(o.a)(this,i)}}function T(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function L(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?T(Object(i),!0).forEach((function(e){Object(l.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function M(t){return Object.entries(t).map((function(t){var e=Object(h.a)(t,2),i=e[0],n=e[1];return"category_id"===i?["categoryId",n]:[i,n]})).reduce((function(t,e){var i=Object(h.a)(e,2),n=i[0],a=i[1];return L(L({},t),{},Object(l.a)({},n,a))}),{})}var U=function(t){Object(s.a)(i,t);var e=R(i);function i(t){var n;return Object(a.a)(this,i),(n=e.call(this,t)).setupElements(),n.setupComponentDisplay(),n}return Object(r.a)(i,[{key:"setupElements",value:function(){this.$form=document.querySelector("#".concat(this.props.formId))}},{key:"preventFormSubmit",value:function(){var t=this;_.a.publish("entityListFormHandler",(function(e){e.preventDefault(),t.submitFormEvent()}))}},{key:"unpreventFormSubmit",value:function(){_.a.publish("entityListFormHandler",null)}},{key:"setupComponentDisplay",value:Object(d.a)((function(){var t=this;if(t.setState({receiveNotifications:t.$receiveNotifications.checked,notificationChannel:t.$notificationChannel.find((function(t){return t.checked})).value,notificationFrequency:t.$notificationFrequency.find((function(t){return t.checked})).value}),k.a.isLoggedIn())return t.setState({disableExpand:!0}),Object(d.j)((function(){return Object(d.b)(t.checkIfSavedSearchExists(!0),(function(e){if(t.setState({expand:!1,disableExpand:e,savedSearchExists:e}),!e)return t.setState({loading:!0}),Object(d.b)(t.getSuggestedTitle(!0),(function(e){t.setState({title:e})}))}))}),(function(e,i){return t.setState({loading:!1}),Object(d.n)(e,i)}));t.setState({disableExpand:!1,title:t.props.defaultSuggestedTitle})}))},{key:"submitFormEvent",value:Object(d.a)((function(){var t=this;return t.setState({loading:!0}),Object(d.g)(Object(d.j)((function(){return Object(d.e)((function(){return Object(d.b)(t.submitForm(),(function(){t.trackEvent(),t.setState({genericError:!1,savedSearchExists:!0,expand:!1})}))}),(function(e){Object(x.b)(e),t.setState({genericError:e.errors[0].title})}))}),(function(e,i){return t.setState({loading:!1}),Object(d.n)(e,i)})))}))},{key:"trackEvent",value:function(){var t=this.props.searchContext,e="".concat("").concat("Email"," Notification ").concat(t," saved");Object(N.trackGoogleAnalytics)(["_trackEvent","Saved Searches",e,this.props.searchUrl,0,!0])}},{key:"getSearchParameters",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=p.a.parse(t,!0),n=i.query,a=b.a.parse(y()(this.$form)),r=[];e?(r.push(a),r.push(this.props.searchParameters)):(r.push(this.props.searchParameters),r.push(a)),r.push(null!=n?n:{});var c=r.reduce((function(t,e){return L(L({},t),M(e))}),{});return delete c.ctl,delete c["saved_search_create[notificationChannel]"],b.a.stringify(c)}},{key:"getSuggestedTitle",value:Object(d.a)((function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=new g.Model("saved-search");i.setAttribute("searchContext",t.props.searchContext),i.setAttribute("searchParameters",t.getSearchParameters(t.props.searchUrl,e));var n=i.serialize();return Object(d.b)(Object(j.default)({url:"/ccapi/v2/user/me/saved-searches/suggest-title",method:"POST",data:n}),(function(t){var e=new g.Store;return e.sync(t),e.find("saved-search").title}))}))},{key:"checkIfSavedSearchExists",value:Object(d.a)((function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=new g.Model("saved-search");i.setAttribute("searchContext",t.props.searchContext),i.setAttribute("searchParameters",t.getSearchParameters(t.props.searchUrl,e));var n=i.serialize();return Object(d.e)((function(){return Object(d.b)(Object(j.default)({url:"/ccapi/v2/user/me/saved-searches/exists",method:"POST",data:n,dataType:"text"}),(function(){return!1}))}),(function(){return!0}))}))},{key:"submitForm",value:Object(d.a)((function(){var t=this,e=new g.Model("saved-search");e.setAttribute("title",t.state.title),e.setAttribute("receiveNotifications",t.state.receiveNotifications),e.setAttribute("notificationChannel",t.state.notificationChannel),e.setAttribute("searchContext",t.props.searchContext),e.setAttribute("searchParameters",t.getSearchParameters(t.props.searchUrl));var i=e.serialize();return Object(d.c)(Object(j.default)({url:"/ccapi/v2/user/me/saved-searches",method:"POST",data:i}))}))},{key:"render",value:function(t,e){if("loading"===t&&(this.$title.disabled=e,this.$cancel.disabled=e,this.$receiveNotifications.closest(".form-label").classList.toggle("is-disabled",e),this.$receiveNotifications.disabled=e,this.$notificationChannel.forEach((function(t){t.closest(".form-label").classList.toggle("is-disabled",e),t.disabled=e})),this.$notificationFrequency.forEach((function(t){t.closest(".form-label").classList.toggle("is-disabled",!0),t.disabled=!0}))),"title"===t&&(this.$title.value=e),"title"===t||"loading"===t){var i=""===this.state.title||!0===this.state.loading;null!==this.$submit&&(this.$submit.disabled=i)}if("disableExpand"===t&&(this.$expand.disabled=e),"savedSearchExists"===t&&e){var n=Object(S.b)(F(),this.props.savedSearchEditUrl,Object(A.b)("ad_search.saved_search.create.success"));this.$expand.replaceWith(n)}if("expand"===t&&(e?this.$information.classList.remove("hidden"):(this.$information.classList.add("hidden"),this.renderRemoveNotifications())),"genericError"===t&&(!0===e?this.renderAddNotifications(Object(A.b)("ad_search.saved_search.create.error"),"invalid"):"string"==typeof e?this.renderAddNotifications(Object(A.b)(e),"invalid"):this.renderRemoveNotifications()),"estimatedNumberOfResults"===t)if(""!==e){var a=e;"search"===this.props.searchContext&&this.isSearchTooGenericForNotifications&&(a="".concat(Object(A.b)("ad_search.saved_search.create.precise_results"),"<br /><br />").concat(e)),this.renderAddNotifications(a,"info")}else this.renderRemoveNotifications();if("notificationChannel"===t)if("push_notification"===e){var r=this.resolveMobileAppStoreLink(),c=r.url,s=r.external;this.renderAddNotificationChannelNotifications("".concat(Object(A.b)("ad_search.saved_search.create.push_notification_usage_notice"),"<br /><br />").concat(Object(A.b)("ad_search.saved_search.create.push_notification_usage_notice_app_link",{linkStartTag:'<a href="'.concat(c,'"').concat(s?' target="_blank" rel="noopener nofollow"':"",">"),linkEndTag:"</a>"}),"."),"info")}else this.renderRemoveNotificationChannelNotifications()}},{key:"resolveMobileAppStoreLink",value:function(){return Object(w.b)()?{url:this.props.mobileAppIosAppStoreUrl,external:!0}:Object(w.a)()?{url:this.props.mobileAppAndroidAppStoreUrl,external:!0}:{url:Object(E.b)({name:"mobile_app_information"}),external:!1}}},{key:"renderAddNotifications",value:function(t,e){var i=Object(S.b)(P(),e,t);this.$notifications.classList.remove("hidden"),this.$notifications.innerHTML="",this.$notifications.appendChild(i)}},{key:"renderRemoveNotifications",value:function(){this.$notifications.classList.add("hidden"),this.$notifications.innerHTML=""}},{key:"renderAddNotificationChannelNotifications",value:function(t,e){var i=Object(S.b)($(),e,t);this.$notificationChannelNotifications.classList.remove("hidden"),this.$notificationChannelNotifications.innerHTML="",this.$notificationChannelNotifications.appendChild(i)}},{key:"renderRemoveNotificationChannelNotifications",value:function(){this.$notificationChannelNotifications.classList.add("hidden"),this.$notificationChannelNotifications.innerHTML=""}},{key:"remove",value:function(){Object(c.a)(Object(u.a)(i.prototype),"remove",this).call(this),this.unpreventFormSubmit()}},{key:"handleReceiveNotifications",value:Object(d.a)((function(t){var e=this;if(t){e.setState({loading:!0});var i=new g.Model("notification-search-result-estimate");i.setAttribute("searchContext",e.props.searchContext),i.setAttribute("searchParameters",e.getSearchParameters(e.props.searchUrl));var n=i.serialize();return Object(d.b)(Object(j.default)({url:"/ccapi/v2/notification-search-result-estimate",method:"POST",data:n}),(function(i){var n=new g.Store;n.sync(i);var a=n.findAll("notification-search-result-estimate"),r=Object(h.a)(a,1)[0];e.isSearchTooGenericForNotifications=r.isSearchTooGenericForNotifications;var c=e.getEstimatedNumberOfResultsForDaysMessage(r.resultCountForTimeWindow,r.timeWindowInDays);e.setState({loading:!1,receiveNotifications:t,estimatedNumberOfResults:c})}))}e.setState({receiveNotifications:t,estimatedNumberOfResults:""})}))},{key:"getEstimatedNumberOfResultsForDaysMessage",value:function(t,e){var i=t/e;return 0===i?Object(A.b)("ad_search.saved_search.create.no_results_in_last_two_weeks"):i>=1.8?Object(A.b)("ad_search.saved_search.create.results_per_day",{results:Math.round(i)}):i<1.8?Object(A.b)("ad_search.saved_search.create.results_per_week",{results:Math.round(7*i)}):""}}]),i}(m.a);Object(l.a)(U,"el",".SavedSearchCreate"),Object(l.a)(U,"events",{"input .SavedSearchCreate-title":function(t){this.setState({title:t.target.value})},"click .SavedSearchCreate-baseAction--expand":function(){this.setState({expand:!this.state.expand})},"click .SavedSearchCreate-action--cancel":function(){this.setState({expand:!1})},"click .SavedSearchCreate-action--submit":function(){this.submitFormEvent()},"change .SavedSearchCreate-receiveNotifications":function(t){this.handleReceiveNotifications(t.target.checked)},"change .SavedSearchCreate-notificationChannel":function(t){this.setState({notificationChannel:t.target.value})},"change .SavedSearchCreate-notificationFrequency":function(t){this.setState({notificationFrequency:t.target.value})},"focus .SavedSearchCreate-title":"preventFormSubmit","blur .SavedSearchCreate-title":"unpreventFormSubmit"}),Object(l.a)(U,"childrenEl",{expand:".SavedSearchCreate-baseAction--expand",information:".SavedSearchCreate-information",title:".SavedSearchCreate-title",submit:".SavedSearchCreate-action--submit",cancel:".SavedSearchCreate-action--cancel",notifications:".SavedSearchCreate-notifications",notificationChannelNotifications:".SavedSearchCreate-notificationChannelNotifications",receiveNotifications:".SavedSearchCreate-receiveNotifications","notificationChannel[]":".SavedSearchCreate-notificationChannel","notificationFrequency[]":".SavedSearchCreate-notificationFrequency"}),Object(l.a)(U,"defaultProps",{searchContext:"",searchParameters:{},searchUrl:"",savedSearchEditUrl:"",loginUrl:"",formId:"",defaultSuggestedTitle:"",hasMobilePushNotificationsSupport:!0,mobileAppIosAppStoreUrl:"",mobileAppAndroidAppStoreUrl:""}),e.default=U}}]);